import{g as E,o as S,r as v,a as r,c as u,e,u as i,F as b,h as V,t as m,b as n,w,i as A,v as L,n as h}from"./index-df55983b.js";import{a as U}from"./axios-3a76d256.js";import{u as q,a as D}from"./useCartStore-6a9ceb38.js";const P={class:"container mt-5"},B=e("h2",{class:"text-center"},"購物車列表",-1),F={class:"text-end"},T=["disabled"],$={class:"table align-middle mt-2"},M=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",{class:"text-end"},"單價")])],-1),I=["onClick"],O={class:"input-group input-group-sm"},R={class:"input-group mb-3"},H=["onUpdate:modelValue","onChange"],N=["value"],j={class:"input-group-text",id:"basic-addon2"},z={class:"text-end"},G={key:1},J=e("td",{colspan:"4",class:"text-center"},[e("h5",null,"Oops，購物車沒有資料！")],-1),K=[J],Q=e("td",{colspan:"3",class:"text-end"},"總計",-1),W={class:"text-end"},X=e("h2",{class:"text-center mt-5"},"填寫資料",-1),Y={class:"form-group"},Z=e("label",{for:"email",class:"text-left w-100"},"Email",-1),ee={class:"form-group mt-4"},te=e("label",{for:"name",class:"text-left w-100"},"收件人姓名",-1),se={class:"form-group mt-4"},le=e("label",{for:"tel",class:"text-left w-100"},"收件人電話",-1),ae={class:"form-group mt-4"},oe=e("label",{for:"address",class:"text-left w-100"},"收件人地址",-1),ne={class:"form-group mt-4"},de=e("label",{for:"message",class:"text-left w-100"},"留言",-1),ie={class:"text-end mt-4"},ce=["disabled"],pe={__name:"CartView",setup(re){const o=q(),f=D(),{VITE_API_BASE:x,VITE_API_PATH:y}={VITE_API_BASE:"https://ec-course-api.hexschool.io/v2",VITE_API_PATH:"hexschool-billyji",BASE_URL:"/vue-2023-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=E({email:"",name:"",tel:"",address:"",message:""}),C=()=>{const g=`${x}/api/${y}/order`;f.changeIsLoading(!0);const a={user:{name:t.value.name,email:t.value.email,tel:t.value.tel,address:t.value.address},message:t.value.message};U.post(g,{data:a}).then(()=>{alert("訂單建立成功"),f.changeIsLoading(!1),t.value={email:"",name:"",tel:"",address:"",message:""},o.getCart()}).catch(c=>{f.changeIsLoading(!1),console.log(c)})};return S(()=>{o.getCart()}),(g,a)=>{const c=v("VField"),_=v("ErrorMessage"),k=v("VForm");return r(),u("div",P,[B,e("div",F,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:a[0]||(a[0]=(...l)=>i(o).deleteCarts&&i(o).deleteCarts(...l)),disabled:i(o).cartsLength===0}," 清空購物車 ",8,T)]),e("table",$,[M,e("tbody",null,[i(o).cartsLength>0?(r(!0),u(b,{key:0},V(i(o).cartData.carts,l=>(r(),u("tr",{key:l.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:s=>i(o).deleteCartItem(l.id)}," x ",8,I)]),e("td",null,m(l.product.title),1),e("td",null,[e("div",O,[e("div",R,[A(e("select",{class:"form-select","onUpdate:modelValue":s=>l.qty=s,onChange:s=>i(o).updateCartItem(l.id,l.product_id,l.qty)},[(r(),u(b,null,V(40,s=>e("option",{value:s,key:`${s}-${l.id}`},m(s),9,N)),64))],40,H),[[L,l.qty]]),e("span",j,m(l.product.unit),1)])])]),e("td",z,m(l.total),1)]))),128)):(r(),u("tr",G,K))]),e("tfoot",null,[e("tr",null,[Q,e("td",W,m(i(o).cartData.total),1)])])]),X,n(k,{class:"mt-2 col-md-6 mx-auto",onSubmit:C},{default:w(({meta:l,errors:s,values:p})=>[e("div",Y,[Z,n(c,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":s.email,"is-valid":!s.email&&p.email}]),autocomplete:"off",placeholder:"請輸入 Email",rules:"email|required",modelValue:t.value.email,"onUpdate:modelValue":a[1]||(a[1]=d=>t.value.email=d)},null,8,["class","modelValue"]),n(_,{name:"email",class:"invalid-feedback"})]),e("div",ee,[te,n(c,{id:"name",label:"收件人姓名",name:"name",type:"text",rules:"required",class:h(["form-control",{"is-invalid":s.name,"is-valid":!s.name&&p.name}]),autocomplete:"off",placeholder:"請輸入收件人姓名",modelValue:t.value.name,"onUpdate:modelValue":a[2]||(a[2]=d=>t.value.name=d)},null,8,["class","modelValue"]),n(_,{name:"name",class:"invalid-feedback"})]),e("div",se,[le,n(c,{id:"tel",label:"收件人電話",name:"tel",type:"tel",rules:"required|min:8",class:h(["form-control",{"is-invalid":s.tel,"is-valid":!s.tel&&p.tel}]),autocomplete:"off",placeholder:"請輸入收件人電話",modelValue:t.value.tel,"onUpdate:modelValue":a[3]||(a[3]=d=>t.value.tel=d)},null,8,["class","modelValue"]),n(_,{name:"tel",class:"invalid-feedback"})]),e("div",ae,[oe,n(c,{id:"address",label:"收件人地址",name:"address",type:"text",rules:"required",class:h(["form-control",{"is-invalid":s.address,"is-valid":!s.address&&p.address}]),autocomplete:"off",placeholder:"請輸入收件人地址",modelValue:t.value.address,"onUpdate:modelValue":a[4]||(a[4]=d=>t.value.address=d)},null,8,["class","modelValue"]),n(_,{name:"address",class:"invalid-feedback"})]),e("div",ne,[de,n(c,{as:"textarea",cols:"30",rows:"3",id:"message",name:"message",class:"form-control",modelValue:t.value.message,"onUpdate:modelValue":a[5]||(a[5]=d=>t.value.message=d)},null,8,["modelValue"])]),e("div",ie,[e("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:!l.valid||i(o).cartsLength===0}," 前往結帳 ",8,ce)])]),_:1})])}}};export{pe as default};
